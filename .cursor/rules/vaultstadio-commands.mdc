---
description: VaultStadio – development and quality commands (Gradle, Make, scripts)
alwaysApply: true
globs: ["*"]
---

# VaultStadio – Commands

Use these commands for build, run, test, quality, and Docker. See also [Makefile](Makefile), [frontend/Makefile](frontend/Makefile), [docs/getting-started/QUICK_START.md](docs/getting-started/QUICK_START.md), [docs/development/CODE_QUALITY.md](docs/development/CODE_QUALITY.md).

**Project layout**: No Gradle at repo root. **Backend** and **frontend** are **standalone** Gradle projects in `backend/` and `frontend/` (each has its own `gradlew`, `settings.gradle.kts`, `build.gradle.kts`). Use `make` from root or run Gradle from the project directory.

## Build

```bash
# Full build (backend + frontend, from root)
make build

# Backend only (from root or from backend/)
make backend-build
# Or: cd backend && ./gradlew :api:build -x test

# Frontend – web WASM (from root or from frontend/)
make frontend-web
# Or from frontend/: ./gradlew :composeApp:wasmJsBrowserDistribution

# Frontend – web WASM development bundle
make frontend-web-dev
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserDevelopmentExecutableDistribution

# Frontend – desktop (from frontend/)
cd frontend && ./gradlew :composeApp:compileKotlinDesktop
# Or: make desktop-run (from root runs frontend desktop)

# Plugins (from root or backend/)
make plugins-build
# Or: cd backend && ./gradlew :plugins:image-metadata:pluginJar :plugins:video-metadata:pluginJar

# Android APK (from root or frontend/)
make android-build
# Or: cd frontend && ./gradlew :androidApp:assembleRelease
```

## Run (development and production)

```bash
# Backend (from root or backend/; requires PostgreSQL)
make backend-run
# Or: cd backend && ./gradlew :api:run

# Frontend – desktop (from root or frontend/)
make desktop-run
# Or: cd frontend && ./gradlew :composeApp:run

# Frontend – web WASM development dev server (source maps, hot reload)
make frontend-run
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserDevelopmentRun

# Frontend – web WASM production dev server (optimized bundle)
make frontend-run-prod
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserProductionRun

# Full dev: Postgres + backend + frontend
make dev
```

## Tests

```bash
# All tests (backend + frontend)
make test

# Backend only (from root or backend/)
make backend-test
# Or: cd backend && ./gradlew :core:test :api:test

# Frontend only (from root or frontend/)
make frontend-test
# Or: cd frontend && make test

# With coverage
make test-coverage
```

## Code Quality (run before commit)

```bash
# 1. Format (run in each project)
cd backend && ./gradlew ktlintFormat
cd frontend && ./gradlew ktlintFormat

# 2. Check no FQN in type positions
./scripts/check-no-fqn.sh

# 3. Static analysis (runs ktlintCheck then detekt)
make lint   # backend detekt
cd frontend && ./gradlew detektMain
```

Quick: `make lint` then `./scripts/check-no-fqn.sh`; format in backend/ and frontend/ with ktlintFormat.

## Docker

```bash
# Start all services (from repo root)
docker-compose -f docker/docker-compose.yml up -d
make docker-up

# Start only Postgres (for local backend run)
docker-compose -f docker/docker-compose.yml up -d postgres

# Logs
docker-compose -f docker/docker-compose.yml logs -f
make docker-logs

# Rebuild and start
docker-compose -f docker/docker-compose.yml up --build -d
make docker-rebuild

# Stop
docker-compose -f docker/docker-compose.yml down
make docker-down
```

## Database

```bash
make db-migrate   # or: cd backend && ./gradlew :api:flywayMigrate
make db-clean     # or: cd backend && ./gradlew :api:flywayClean
```

## Release / Clean

```bash
make release   # shadowJar, WASM dist, Android, desktop package
make clean     # backend + frontend clean
```

## Helm (TrueNAS / Kubernetes)

```bash
helm install vaultstadio ./helm/vaultstadio
make helm-install
helm upgrade vaultstadio ./helm/vaultstadio
make helm-upgrade
```
