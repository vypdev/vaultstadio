---
description: VaultStadio – development and quality commands (Gradle, Make, scripts)
alwaysApply: true
globs: ["*"]
---

# VaultStadio – Commands

Use these commands for build, run, test, quality, and Docker. See also [Makefile](Makefile), [frontend/Makefile](frontend/Makefile), [docs/getting-started/QUICK_START.md](docs/getting-started/QUICK_START.md), [docs/development/CODE_QUALITY.md](docs/development/CODE_QUALITY.md).

**Project layout**: Backend is part of the root Gradle project (`:backend:*`). Frontend is a **standalone** project in `frontend/` (run Gradle from `frontend/` or use `make frontend-*` from root).

## Build

```bash
# Full build (backend from root + frontend from frontend/)
make build

# Backend only (from repo root)
./gradlew :backend:api:build -x test
make backend-build

# Frontend – web WASM (from repo root or from frontend/)
make frontend-web
# Or from frontend/: ./gradlew :composeApp:wasmJsBrowserDistribution

# Frontend – web WASM development bundle
make frontend-web-dev
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserDevelopmentExecutableDistribution

# Frontend – desktop (from frontend/)
cd frontend && ./gradlew :composeApp:compileKotlinDesktop
# Or: make desktop-run (from root runs frontend desktop)

# Plugins (from repo root)
./gradlew :backend:plugins:image-metadata:pluginJar :backend:plugins:video-metadata:pluginJar
make plugins-build

# Android APK (from root or frontend/)
make android-build
# Or: cd frontend && ./gradlew :androidApp:assembleRelease
```

## Run (development and production)

```bash
# Backend (from repo root; requires PostgreSQL)
./gradlew :backend:api:run
make backend-run

# Frontend – desktop (from root or frontend/)
make desktop-run
# Or: cd frontend && ./gradlew :composeApp:run

# Frontend – web WASM development dev server (source maps, hot reload)
make frontend-run
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserDevelopmentRun

# Frontend – web WASM production dev server (optimized bundle)
make frontend-run-prod
# Or: cd frontend && ./gradlew :composeApp:wasmJsBrowserProductionRun

# Full dev: Postgres + backend + frontend
make dev
```

## Tests

```bash
# All tests (backend + frontend)
make test

# Backend only (from repo root)
./gradlew :backend:core:test :backend:api:test
make backend-test

# Frontend only (from root or frontend/)
make frontend-test
# Or: cd frontend && make test

# With coverage
make test-coverage
```

## Code Quality (run before commit)

```bash
# 1. Format
./gradlew ktlintFormat
cd frontend && ./gradlew ktlintFormat

# 2. Check no FQN in type positions
./scripts/check-no-fqn.sh

# 3. Static analysis (runs ktlintCheck then detekt)
./gradlew detekt
cd frontend && ./gradlew detektMain
```

Quick: `./gradlew ktlintFormat && ./scripts/check-no-fqn.sh && ./gradlew detekt`

## Docker

```bash
# Start all services (from repo root)
docker-compose -f docker/docker-compose.yml up -d
make docker-up

# Start only Postgres (for local backend run)
docker-compose -f docker/docker-compose.yml up -d postgres

# Logs
docker-compose -f docker/docker-compose.yml logs -f
make docker-logs

# Rebuild and start
docker-compose -f docker/docker-compose.yml up --build -d
make docker-rebuild

# Stop
docker-compose -f docker/docker-compose.yml down
make docker-down
```

## Database

```bash
./gradlew :backend:api:flywayMigrate   # migrate
make db-migrate
./gradlew :backend:api:flywayClean     # clean (dev)
make db-clean
```

## Release / Clean

```bash
make release   # shadowJar, WASM dist, Android, desktop package
make clean     # backend + frontend clean
```

## Helm (TrueNAS / Kubernetes)

```bash
helm install vaultstadio ./helm/vaultstadio
make helm-install
helm upgrade vaultstadio ./helm/vaultstadio
make helm-upgrade
```
